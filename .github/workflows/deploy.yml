name: CI devops VM 2024

on:
  push:
    branches: 
      - main
  pull_request: 

jobs:
  deploy:
    runs-on: ubuntu-22.04
    if: ${{ github.event.workflow_run.conclusion == 'success' }}

    steps:
      - name: Setup SSH and known hosts
        uses: webfactory/ssh-agent@v0.5.4
        with:
          ssh-private-key: ${{ secrets.id_rsa }}

      - name: Install Ansible
        run: sudo apt-get update && sudo apt-get install -y ansible

     

      - name: Run ansible
         working-directory: ansible
        run: ansible-playbook -i inventories/setup.yml ansible/playbook.yml    
      
    
    
    #    run: ansible-playbook -i ansible/inventories/setup.yml ansible/playbook.yml
